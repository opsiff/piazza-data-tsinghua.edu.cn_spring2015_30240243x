{"aid": "j0fevhmriou650", "result": {"status": "active", "unique_views": 77, "request_instructor_me": false, "change_log": [{"data": "i7xc9asjqvy5xu", "anon": "no", "when": "2015-03-31T13:26:43Z", "uid": "i6un8w0cKfP", "type": "create"}, {"data": "i7xd3sw6qcx7nk", "anon": "no", "when": "2015-03-31T13:50:26Z", "uid": "i6un8w0cKfP", "type": "update"}, {"uid": "i6un8w0cKfP", "data": "i7xdegcyg2x30t", "when": "2015-03-31T13:58:43Z", "to": "i7xc9ashjl65xt", "anon": "no", "type": "s_answer"}, {"data": "i7xdeu4pn7f365", "anon": "no", "when": "2015-03-31T13:59:01Z", "uid": "i6un8w0cKfP", "type": "s_answer_update"}, {"data": "i7xdssxqe846ef", "anon": "no", "when": "2015-03-31T14:09:52Z", "uid": "i6un8w0cKfP", "type": "s_answer_update"}, {"data": "i7xdxjm467onk", "anon": "full", "when": "2015-03-31T14:13:33Z", "type": "s_answer_update"}, {"to": "i7xc9ashjl65xt", "anon": "full", "when": "2015-03-31T14:13:51Z", "type": "followup"}, {"to": "i7xc9ashjl65xt", "anon": "no", "when": "2015-03-31T17:40:25Z", "uid": "i6uqzf449em3ex", "type": "followup"}, {"to": "i7xc9ashjl65xt", "anon": "no", "when": "2015-04-01T01:32:23Z", "uid": "hcrrjuyequh4bt", "type": "followup"}, {"uid": "hdjoucuyb836fq", "data": "i7y4jrvayk82lt", "when": "2015-04-01T02:38:41Z", "to": "i7xc9ashjl65xt", "anon": "no", "type": "i_answer"}, {"data": "i7y592ghm2b3o7", "anon": "no", "when": "2015-04-01T02:58:21Z", "uid": "hdjoucuyb836fq", "type": "i_answer_update"}, {"data": "i7y5alkw5kf1mk", "anon": "no", "when": "2015-04-01T02:59:32Z", "uid": "hdjoucuyb836fq", "type": "i_answer_update"}, {"data": "i7y5h2dktlb1ub", "anon": "no", "when": "2015-04-01T03:04:34Z", "uid": "hsfa0sawctb6v4", "type": "i_answer_update"}, {"to": "i7xc9ashjl65xt", "anon": "full", "when": "2015-04-01T12:54:07Z", "type": "feedback"}, {"to": "i7xc9ashjl65xt", "anon": "no", "when": "2015-04-01T13:00:35Z", "uid": "i6un8w0cKfP", "type": "feedback"}, {"to": "i7xc9ashjl65xt", "anon": "no", "when": "2015-04-01T13:01:11Z", "uid": "i6un8w0cKfP", "type": "feedback"}, {"data": "i8704yh3who51q", "anon": "no", "when": "2015-04-07T07:45:06Z", "uid": "hs2sszxmgag6jq", "type": "update"}, {"data": "i870so8truy2do", "anon": "no", "when": "2015-04-07T08:03:33Z", "uid": "hs2sszxmgag6jq", "type": "update"}, {"type": "update", "anon": "no", "when": "2017-03-18T01:49:25Z", "data": "j0eli7362v8hd", "uid": "hdjonbiyfs62ie"}, {"type": "update", "anon": "no", "when": "2017-03-18T04:07:15Z", "data": "j0eqfg4br1366n", "uid": "hdjonbiyfs62ie"}], "upvote_ids": [], "id": "i7xc9ashjl65xt", "bookmarked": 9, "no_answer": 0, "i_edits": [], "is_bookmarked": false, "children": [{"folders": [], "is_tag_endorse": false, "created": "2015-03-31T13:58:43Z", "type": "s_answer", "tag_endorse_arr": [], "id": "i7xdegb3ywa30s", "bucket_name": "Today", "config": {}, "tag_endorse": [], "bucket_order": 2, "data": {"embed_links": []}, "children": [], "history": [{"content": "<p></p>", "anon": "full", "created": "2015-03-31T14:13:33Z", "subject": ""}, {"content": "<p>这个也许有帮助</p>\n<p><a href=\"http://osdir.com/ml/qemu-devel/2010-03/msg01830.html\" target=\"_blank\">http://osdir.com/ml/qemu-devel/2010-03/msg01830.html</a></p>", "anon": "no", "created": "2015-03-31T14:09:52Z", "uid": "i6un8w0cKfP", "subject": ""}, {"content": "<p>然后我发现了这个</p>\n<p><a href=\"http://osdir.com/ml/qemu-devel/2010-03/msg01830.html\" target=\"_blank\">http://osdir.com/ml/qemu-devel/2010-03/msg01830.html</a></p>", "anon": "no", "created": "2015-03-31T13:59:01Z", "uid": "i6un8w0cKfP", "subject": ""}, {"content": "<p>然后我发现了这个</p>\n<p>http://osdir.com/ml/qemu-devel/2010-03/msg01830.html</p>", "anon": "no", "created": "2015-03-31T13:58:43Z", "uid": "i6un8w0cKfP", "subject": ""}]}, {"folders": [], "updated": "2015-03-31T14:13:51Z", "no_upvotes": 0, "created": "2015-03-31T14:13:51Z", "type": "followup", "no_answer": 0, "id": "i7xdxx0qux81tt", "anon": "full", "bucket_name": "Week 3/29 - 4/4", "config": {}, "bucket_order": 107, "data": null, "children": [], "subject": "<p>这个也许有帮助</p>\n<p><a href=\"http://osdir.com/ml/qemu-devel/2010-03/msg01830.html\">http://osdir.com/ml/qemu-devel/2010-03/msg01830.html</a><a href=\"http://osdir.com/ml/qemu-devel/2010-03/msg01830.html\" target=\"_blank\"></a></p>\n<p>似乎确实是会清的</p>\n<p>我仍然不明白它闲着没事清俩寄存器有什么作用</p>"}, {"folders": [], "updated": "2015-03-31T17:40:25Z", "no_upvotes": 0, "uid": "i6uqzf449em3ex", "created": "2015-03-31T17:40:25Z", "type": "followup", "no_answer": 0, "id": "i7xlbkn6r153ht", "anon": "no", "bucket_name": "Week 3/29 - 4/4", "config": {}, "bucket_order": 107, "data": null, "children": [{"folders": [], "updated": "2015-04-01T12:54:07Z", "created": "2015-04-01T12:54:07Z", "type": "feedback", "id": "i7yqj8pwgfnow", "anon": "full", "bucket_name": "Week 3/29 - 4/4", "config": {}, "bucket_order": 107, "data": null, "children": [], "subject": "<p>确实是iret清的 我以为设了tf_gs就没事了 结果调死我了 单步了一晚上才发现</p>"}, {"folders": [], "updated": "2015-04-01T13:01:11Z", "uid": "i6un8w0cKfP", "created": "2015-04-01T13:01:11Z", "type": "feedback", "id": "i7yqsbk62jlwk", "anon": "no", "bucket_name": "Week 3/29 - 4/4", "config": {}, "bucket_order": 107, "data": null, "children": [], "subject": "<p>不小心匿名了。。</p>\n<p>前面那个pop %gs带有强烈的误导性&#xff0c;一个会被iret修改的东西不需要push再pop&#xff0c;所以我根本没怀疑过iret会动这玩意。现在看来是qemu写错了&#xff0c;气死我了。。</p>"}], "subject": "<p>不是iret清零的吧&#xff0c;是那个popl %gs吧&#xff1f;</p>"}, {"folders": [], "updated": "2015-04-01T01:32:23Z", "no_upvotes": 0, "uid": "hcrrjuyequh4bt", "created": "2015-04-01T01:32:23Z", "type": "followup", "no_answer": 0, "id": "i7y26ik8ewsbh", "anon": "no", "bucket_name": "Week 3/29 - 4/4", "config": {}, "bucket_order": 107, "data": null, "children": [{"folders": [], "updated": "2015-04-01T13:00:35Z", "uid": "i6un8w0cKfP", "created": "2015-04-01T13:00:35Z", "type": "feedback", "id": "i7yqrk1k9ymgg", "anon": "no", "bucket_name": "Week 3/29 - 4/4", "config": {}, "bucket_order": 107, "data": null, "children": [], "subject": "<p>你在哪段代码调试中发现了这个问题?</p>\n<p>我在iret回用户程序之后会莫名其妙的崩溃&#xff0c;经过调试发现&#xff05;gs变成0了&#xff0c;单步后发现被iret清了&#xff0c;只有在ring0到3外加一些条件才会发生。</p>\n<p>我原以为iret不会修改gs&#xff0c;用户程序也不能修改段寄存器&#xff0c;所以直接在trapframe中设定gs&#xff0c;以为这个量可以留住。</p>\n<p>你的代码放在哪里? 我想看看。</p>\n<p><a href=\"https://github.com/glglwty/ucore_lab/tree/a61a5a5603dd7b9940ddc08bbc35c0ac0d315038\">https://github.com/glglwty/ucore_lab/tree/a61a5a5603dd7b9940ddc08bbc35c0ac0d315038</a></p>\n<p>断点设定在trapentry.S的trapret&#xff0c;pop %gs后查看gs正常&#xff0c;iret执行后立刻变成0。</p>\n<div>\n<div>\n<p>你的qemu的版本是?</p>\n</div>\n</div>\n<div>\n<div>\n<div>\n<div>QEMU emulator version 2.1.0 (Debian 2.1&#43;dfsg-4ubuntu6.4), Copyright (c) 2003-2008 Fabrice Bellard</div>\n</div>\n</div>\n</div>"}], "subject": "<p>iret 会根据 kernel stack返回到内核空间和用户空间&#xff0c;并修改部分寄存器&#xff0c;但不包括GS.</p>\n<p>你在哪段代码调试中发现了这个问题?</p>\n<p>你的代码放在哪里? 我想看看。</p>\n<p>你的qemu的版本是?</p>"}, {"folders": [], "is_tag_endorse": false, "created": "2015-04-01T02:38:41Z", "type": "i_answer", "tag_endorse_arr": [], "id": "i7y4jrv8w0r2ls", "bucket_name": "Today", "config": {}, "tag_endorse": [], "bucket_order": 2, "data": {"embed_links": []}, "children": [], "history": [{"content": "<p>x86手册中iret的定义没有修改gs的可能&#xff0c;但是在qemu里执行在iret时&#xff0c;如果以下条件同时成立&#xff1a;</p>\n<ul><li>GS的高13位非0&#xff1b;</li><li>GS是数据段&#xff08;type域最高位为0&#xff09;&#xff1b;</li><li>GS对应段的dpl小于cpl&#xff08;比如回用户态时&#xff09;。\n<ul></ul>\n</li></ul>\n<p>那么GS会被清成0&#xff08;理由不明&#xff09;。</p>\n<p></p>\n<p>一种workaround是在用户进程进入内核时恢复gs&#xff0c;这个gs可以保存在进程的PCB里。</p>\n<p></p>\n<p>把GS所指的描述符的DPL设成3&#xff0c;应该就没有问题了</p>", "anon": "no", "created": "2015-04-01T03:04:34Z", "uid": "hsfa0sawctb6v4", "subject": ""}, {"content": "<p>x86手册中iret的定义没有修改gs的可能&#xff0c;但是在qemu里执行在iret时&#xff0c;如果以下条件同时成立&#xff1a;</p>\n<ul><li>GS的高13位非0&#xff1b;</li><li>GS是数据段&#xff08;type域最高位为0&#xff09;&#xff1b;</li><li>GS对应段的dpl小于cpl&#xff08;比如回用户态时&#xff09;。\n<ul></ul>\n</li></ul>\n<p>那么GS会被清成0&#xff08;理由不明&#xff09;。</p>\n<p></p>\n<p>一种workaround是在用户进程进入内核时恢复gs&#xff0c;这个gs可以保存在进程的PCB里。</p>", "anon": "no", "created": "2015-04-01T02:59:32Z", "uid": "hdjoucuyb836fq", "subject": ""}, {"content": "<p>这个是qemu的行为&#xff0c;在iret时&#xff0c;如果以下条件同时成立&#xff1a;</p>\n<ul><li>GS的高13位非0&#xff1b;</li><li>GS是数据段&#xff08;type域最高位为0&#xff09;&#xff1b;</li><li>GS对应段的dpl小于cpl&#xff08;比如回用户态时&#xff09;。\n<ul></ul>\n</li></ul>\n<p>那么GS会被清成0。</p>\n<p></p>\n<p>一种workaround是在用户进程进入内核时恢复gs&#xff0c;这个gs可以保存在进程的PCB里。</p>", "anon": "no", "created": "2015-04-01T02:58:21Z", "uid": "hdjoucuyb836fq", "subject": ""}, {"content": "<p>请试一下把gs对应段的权限从USER_DS改成KERNEL_DS。</p>", "anon": "no", "created": "2015-04-01T02:38:41Z", "uid": "hdjoucuyb836fq", "subject": ""}]}], "nr": 218, "bucket_order": 2, "type": "question", "folders": ["big_proj", "2016", "特权级"], "no_answer_followup": 0, "num_favorites": 0, "bucket_name": "Today", "q_edits": [], "data": {"embed_links": []}, "request_instructor": 0, "tags": ["2016", "big_proj", "student", "特权级"], "created": "2015-03-31T13:26:43Z", "is_tag_good": false, "config": {}, "s_edits": [], "my_favorite": false, "default_anonymity": "no", "t": 1489851094275, "tag_good": [], "tag_good_arr": [], "history": [{"content": "<p>我以为没人会动这玩意结果调了一天。。</p>", "anon": "no", "created": "2017-03-18T04:07:15Z", "uid": "hdjonbiyfs62ie", "subject": "iret在什么情况下会把%gs变成0&#xff1f;"}, {"content": "<p>我以为没人会动这玩意结果调了一天。。</p>", "anon": "no", "created": "2017-03-18T01:49:25Z", "uid": "hdjonbiyfs62ie", "subject": "iret在什么情况下会把%gs变成0&#xff1f;"}, {"content": "<p>我以为没人会动这玩意结果调了一天。。</p>", "anon": "no", "created": "2015-04-07T08:03:33Z", "uid": "hs2sszxmgag6jq", "subject": "iret在什么情况下会把%gs变成0&#xff1f;"}, {"content": "<p>我以为没人会动这玩意结果调了一天。。</p>\n#pin", "anon": "no", "created": "2015-04-07T07:45:06Z", "uid": "hs2sszxmgag6jq", "subject": "iret在什么情况下会把%gs变成0&#xff1f;"}, {"content": "<p>我以为没人会动这玩意结果调了一天。。</p>", "anon": "no", "created": "2015-03-31T13:50:26Z", "uid": "i6un8w0cKfP", "subject": "iret在什么情况下会把%gs变成0&#xff1f;"}, {"content": "<p>如题所问 搜索未果</p>", "anon": "no", "created": "2015-03-31T13:26:43Z", "uid": "i6un8w0cKfP", "subject": "iret在什么情况下会把%gs变成0&#xff1f;"}]}, "error": null}