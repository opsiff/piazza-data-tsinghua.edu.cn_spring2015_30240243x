{"aid": "j0feuvggd2qew", "result": {"status": "active", "unique_views": 26, "request_instructor_me": false, "change_log": [{"type": "create", "anon": "no", "when": "2017-03-15T00:36:47Z", "data": "j0a8l8j2wt521q", "uid": "ie7xy4itft81pr"}, {"type": "update", "anon": "no", "when": "2017-03-18T01:46:11Z", "data": "j0ele1b1sxg6rz", "uid": "hdjonbiyfs62ie"}, {"type": "update", "anon": "no", "when": "2017-03-18T04:04:37Z", "data": "j0eqc2ckgk394", "uid": "hdjonbiyfs62ie"}, {"uid": "hdjonbiyfs62ie", "type": "i_answer", "when": "2017-03-18T04:40:16Z", "to": "j0a8l8j0t0021p", "anon": "no", "data": "j0erlwsbjt363v"}], "upvote_ids": [], "id": "j0a8l8j0t0021p", "bookmarked": 6, "no_answer": 0, "i_edits": [], "is_bookmarked": false, "children": [{"folders": [], "is_tag_endorse": false, "created": "2017-03-18T04:40:16Z", "type": "i_answer", "tag_endorse_arr": [], "id": "j0erlws8yr763u", "bucket_name": "Today", "config": {}, "tag_endorse": [], "bucket_order": 2, "data": {"embed_links": []}, "children": [], "history": [{"content": "<p>先回答同学的问题&#xff0c;这里是不矛盾的&#xff0c;这两个条件不会同时检查。通过门访问时&#xff0c;会先有一个栈切换。栈切换时&#xff0c;特权级已经变了。</p>\n<p></p>\n<p>X86的特权级是同学们在学习操作系统&#xff0c;特别是在做实验时遇到的一个大问题。经常是好像搞明白了&#xff0c;但又似懂非懂。于是&#xff0c;把相关的一些问答帖子清理了一下&#xff0c;给出下面的汇总。供同学们参考。</p>\n<p></p>\n<p>下面帖子是关于特权级问题中&#xff0c;就iret执行过程中特权级判断和切换的最清楚分析&#xff08;至少目前是最清楚的&#xff09;。我再表扬一次。<br /><a href=\"https://www.piazza.com/class/i5j09fnsl7k5x0?cid=691\">https://piazza.com/class/i5j09fnsl7k5x0?cid=691</a></p>\n<p>特权级切换时iret的准确过程&#xff08;课上提问&#xff09;</p>\n<p></p>\n<p>首先需要讨论的特权级的概念。我们通常讨论时说的cpl, rpl和dpl已把大家搞得有些晕了&#xff0c;细看下去会遇到下面的一些名词CPL, RPL, DPL, gate dpl, DPL of the segment descriptor, IOPL等。下面是Intel手册&#xff08;这里特指 <a href=\"http://os.cs.tsinghua.edu.cn/oscourse/OS2017spring/lecture04#X86_CPU.2BYktRjA-\">http://os.cs.tsinghua.edu.cn/oscourse/OS2017spring/lecture04#X86_CPU.2BYktRjA-</a> 处的4684页手册&#xff09;中就这些名词的准确定义&#xff0c;但它们并不通俗。希望同学们在本贴后面回复你对这些名词的理解&#xff0c;从而得到一个适合初学操作系统课的同学的定义。</p>\n<p></p>\n<p>Page 152/4684:</p>\n<p>6.3.5 Calls to Other Privilege Levels<br />Figure 6-3. Protection Rings Page 2817/4684: 5.5 PRIVILEGE LEVELS<br />Figure 5-3. Protection Rings<br />这里给出了CPL、RPL和DPL的准确定义。 </p>\n<p></p>\n<p>Page 79/4684:<br />3.4.3.3 System Flags and IOPL Field<br />IOPL (bits 12 and 13) I/O privilege level field — Indicates the I/O privilege level of the currently running program or task. The current privilege level (CPL) of the currently running program or task must be less than or equal to the I/O privilege level to access the I/O address space.<br />这是IOPL的准确定义。</p>\n<p></p>\n<p>Page 406/4684:</p>\n<p>18.5.1 I/O Privilege Level<br />In a typical protection ring model, access to the I/O address space is restricted to privilege levels 0 and 1.</p>\n<p></p>\n<p>第二个问题是执行指令时的特权级判断条件问题。最简洁的表述是下面的不等式&#xff0c;前半段说通常指令执行时的特权级判断&#xff0c;当前进程只能访问特权级比自己大的代码和数据&#xff1b;后关段说int指令执行&#xff0c;用户可以使用特权级比自己小的操作系统服务。这个表达式出现在早的intel手册中&#xff0c;2016年的手册中没有了&#xff08;可参见下面链接 <a href=\"http://www.cnblogs.com/coryxie/p/3967425.html\">http://www.cnblogs.com/coryxie/p/3967425.html</a> &#xff09;。</p>\n<p></p>\n<p>target dpl &lt;= max(cpl, rpl) &lt;= gate dpl</p>\n<p></p>\n<p>下面两处分别是intel手册中对这两个判断的准确描述&#xff0c;插图应该是很直观的。当然&#xff0c;它们也还不够通俗。希望同学们在本贴后面回复你的理解。</p>\n<p></p>\n<p>Page 2819/4684:</p>\n<p>5.6 PRIVILEGE LEVEL CHECKING WHEN ACCESSING DATA SEGMENTS<br />Figure 5-4. Privilege Check for Data Access<br />这个图清楚地给出数据访问时的特权级判断条件&#xff1a;max(cpl, rpl)&lt;=dpl。</p>\n<p></p>\n<p>Page 2827/4684:<br />Figure 5-12. Example of Accessing Call Gates At Various Privilege Levels<br />这个图对应的解释文字中“in Figure 5-15”应该是“in Figure 5-12”。这个图清楚地给出了通过门访问门的特权级判断条件&#xff1a;<br />cpl=rpl, cpl &lt;= gate dpl</p>\n<p></p>\n<p>希望能引起同学们对这个问题的讨论兴趣。</p>", "anon": "no", "created": "2017-03-18T04:40:16Z", "uid": "hdjonbiyfs62ie", "subject": ""}]}], "nr": 1009, "bucket_order": 2, "type": "question", "folders": ["lecture7", "2017", "特权级"], "no_answer_followup": 0, "num_favorites": 0, "bucket_name": "Today", "q_edits": [], "data": {"embed_links": []}, "request_instructor": 0, "tags": ["2017", "lecture7", "student", "特权级"], "created": "2017-03-15T00:36:47Z", "is_tag_good": false, "config": {}, "s_edits": [], "my_favorite": false, "default_anonymity": "no", "t": 1489851065536, "tag_good": [], "tag_good_arr": [], "history": [{"content": "<p>课件上写到访问门时要求CPL &lt;= DPL(门)&amp; CPL&gt;= DPL(段),但陈老师上课的时候提到门的作用是让低特权级的有可能访问到高特权级&#xff0c;而段的作用是高特权级进行检查和保护。<br />这样理解的话访问门时应是CPL &gt;= DPL(门&#xff09;&amp; CPL &lt;= DPL(段&#xff09;&#xff0c;即访问门时特权较低&#xff0c;然后段检查时要求特权较高&#xff0c;与课件中所示矛盾&#xff1f;</p>", "anon": "no", "created": "2017-03-18T04:04:37Z", "uid": "hdjonbiyfs62ie", "subject": "关于x-86访问时特权级的问题"}, {"content": "<p>课件上写到访问门时要求CPL &lt;= DPL(门)&amp; CPL&gt;= DPL(段),但陈老师上课的时候提到门的作用是让低特权级的有可能访问到高特权级&#xff0c;而段的作用是高特权级进行检查和保护。<br />这样理解的话访问门时应是CPL &gt;= DPL(门&#xff09;&amp; CPL &lt;= DPL(段&#xff09;&#xff0c;即访问门时特权较低&#xff0c;然后段检查时要求特权较高&#xff0c;与课件中所示矛盾&#xff1f;</p>", "anon": "no", "created": "2017-03-18T01:46:11Z", "uid": "hdjonbiyfs62ie", "subject": "关于x-86访问时特权级的问题"}, {"content": "课件上写到访问门时要求CPL &lt;= DPL(门)&amp; CPL&gt;= DPL(段),但陈老师上课的时候提到门的作用是让低特权级的有可能访问到高特权级&#xff0c;而段的作用是高特权级进行检查和保护。\n这样理解的话访问门时应是CPL &gt;= DPL(门&#xff09;&amp; CPL &lt;= DPL(段&#xff09;&#xff0c;即访问门时特权较低&#xff0c;然后段检查时要求特权较高&#xff0c;与课件中所示矛盾&#xff1f;", "anon": "no", "created": "2017-03-15T00:36:47Z", "uid": "ie7xy4itft81pr", "subject": "关于x-86访问时特权级的问题"}]}, "error": null}